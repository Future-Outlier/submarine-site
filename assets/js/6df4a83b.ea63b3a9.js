"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2658],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return c}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),m=u(n),c=r,h=m["".concat(s,".").concat(c)]||m[c]||d[c]||i;return n?a.createElement(h,l(l({ref:t},p),{},{components:n})):a.createElement(h,l({ref:t},p))}));function c(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var u=2;u<i;u++)l[u]=n[u];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},4942:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return s},default:function(){return c},frontMatter:function(){return o},metadata:function(){return u},toc:function(){return d}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),l=["components"],o={title:"Security Implementation"},s=void 0,u={unversionedId:"designDocs/wip-designs/security-implementation",id:"designDocs/wip-designs/security-implementation",title:"Security Implementation",description:"\x3c!--",source:"@site/docs/designDocs/wip-designs/security-implementation.md",sourceDirName:"designDocs/wip-designs",slug:"/designDocs/wip-designs/security-implementation",permalink:"/docs/next/designDocs/wip-designs/security-implementation",editUrl:"https://github.com/apache/submarine/edit/master/website/docs/designDocs/wip-designs/security-implementation.md",tags:[],version:"current",frontMatter:{title:"Security Implementation"},sidebar:"docs",previous:{title:"Submarine Launcher",permalink:"/docs/next/designDocs/wip-designs/submarine-launcher"}},p={},d=[{value:"Handle User&#39;s Credential",id:"handle-users-credential",level:2},{value:"Authentication",id:"authentication",level:2},{value:"Supported authentication types",id:"supported-authentication-types",level:3},{value:"None",id:"none",level:4},{value:"Simple",id:"simple",level:4},{value:"OAuth2",id:"oauth2",level:4},{value:"OIDC",id:"oidc",level:4},{value:"LDAP",id:"ldap",level:4},{value:"SAML",id:"saml",level:4},{value:"CAS",id:"cas",level:4},{value:"Configuration",id:"configuration",level:3},{value:"Design and implementation",id:"design-and-implementation",level:3},{value:"Users",id:"users",level:3},{value:"Department",id:"department",level:4},{value:"Role",id:"role",level:4},{value:"RBAC",id:"rbac",level:3}],m={toc:d};function c(e){var t=e.components,n=(0,r.Z)(e,l);return(0,i.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"handle-users-credential"},"Handle User's Credential"),(0,i.kt)("p",null,"Users credential includes Kerberoes Keytabs, Docker registry credentials, Github ssh-keys, etc."),(0,i.kt)("p",null,"User's credential must be stored securitely, for example, via KeyCloak or K8s Secrets."),(0,i.kt)("p",null,"(More details TODO)"),(0,i.kt)("h2",{id:"authentication"},"Authentication"),(0,i.kt)("p",null,"We use ",(0,i.kt)("a",{parentName:"p",href:"https://www.pac4j.org/"},"pac4j")," as the secure authentication component of ",(0,i.kt)("inlineCode",{parentName:"p"},"submarine-server"),".\nBased on ",(0,i.kt)("inlineCode",{parentName:"p"},"pac4j"),", we plan to support popular authentication services such as OAuth2/OpenID Connect (OIDC), LDAP, SAML, CAS, etc.\nand use a token-based method to handle external request services and internal message communication.\nIn the initial version we will first integrate OAuth2/OIDC, LDAP,\nand a simple login mode that does not rely on other authentication services.\nThere are already some PRs in the community to try to integrate some authentication services into ",(0,i.kt)("inlineCode",{parentName:"p"},"submarine"),"\n( ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/apache/submarine/pull/833"},"New SSO function based on OIDC")," and ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/apache/submarine/pull/419"},"Create rest api to authenticate user from LDAP")," ),\nWe will try to do combines on the basis of these PRs together."),(0,i.kt)("h3",{id:"supported-authentication-types"},"Supported authentication types"),(0,i.kt)("h4",{id:"none"},"None"),(0,i.kt)("p",null,"When supported authentication, we will also support a way to turn off authentication and call the service directly,\nso that previous versions of submarine that not support authentication can call the service.\nAuthentication is provided by default in submarine, but we can also turn off authentication by manually setting ",(0,i.kt)("inlineCode",{parentName:"p"},"submarine.auth.type")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"none"),"."),(0,i.kt)("h4",{id:"simple"},"Simple"),(0,i.kt)("p",null,"Provides a simple way for authentication.\nWhen users log in to the system, the username and password entered will be matched against the ",(0,i.kt)("inlineCode",{parentName:"p"},"sys_user")," table within the system,\nand if the form is met a ",(0,i.kt)("inlineCode",{parentName:"p"},"token")," will be generated and returned to the frontend.\nAll services will need to carry the ",(0,i.kt)("inlineCode",{parentName:"p"},"token")," in the request header to confirm the user's identity."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Authorization: Bearer <token>\n")),(0,i.kt)("h4",{id:"oauth2"},"OAuth2"),(0,i.kt)("p",null,"Supports OAuth2 as a user authentication service, requiring a jump to a third-party authentication platform for single sign-on services when logging into ",(0,i.kt)("inlineCode",{parentName:"p"},"submarine"),".\n",(0,i.kt)("inlineCode",{parentName:"p"},"Submarine")," requires an OAuth2 token as an authentication credential, including the refresh token.\nIf the logged-in user is not in ",(0,i.kt)("inlineCode",{parentName:"p"},"submarine"),", the user data will be created automatically."),(0,i.kt)("h4",{id:"oidc"},"OIDC"),(0,i.kt)("p",null,"OIDC is similar to OAuth2, except that ",(0,i.kt)("inlineCode",{parentName:"p"},"submarine.auth.oidc.discover.uri")," is required to support ",(0,i.kt)("a",{parentName:"p",href:"https://openid.net/specs/openid-connect-discovery-1_0.html"},"OpenID Connect Discovery"),",\nwhere an OpenID server publishes its metadata at a well-known URL, typically"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"https://server.com/.well-known/openid-configuration\n")),(0,i.kt)("p",null,"This URL returns a JSON listing of the OpenID/OAuth endpoints, supported scopes and claims, public keys used to sign the tokens, and other details.\nThe ",(0,i.kt)("inlineCode",{parentName:"p"},"pac4j")," can use this information to construct a request to the OpenID server.\nThe field names and values are defined in the OpenID Connect Discovery Specification. Here is an example of data returned:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "issuer": "https://example.com/",\n    "authorization_endpoint": "https://example.com/authorize",\n    "token_endpoint": "https://example.com/token",\n    "userinfo_endpoint": "https://example.com/userinfo",\n    "jwks_uri": "https://example.com/.well-known/jwks.json",\n    "scopes_supported": [\n        "pets_read",\n        "pets_write",\n        "admin"\n    ],\n    "response_types_supported": [\n        "code",\n        "id_token",\n        "token id_token"\n    ],\n    "token_endpoint_auth_methods_supported": [\n      "client_secret_basic"\n    ],\n    ...\n}\n')),(0,i.kt)("h4",{id:"ldap"},"LDAP"),(0,i.kt)("p",null,"[TODO]"),(0,i.kt)("h4",{id:"saml"},"SAML"),(0,i.kt)("p",null,"[TODO]"),(0,i.kt)("h4",{id:"cas"},"CAS"),(0,i.kt)("p",null,"[TODO]"),(0,i.kt)("h3",{id:"configuration"},"Configuration"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Attribute"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"),(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Default"),(0,i.kt)("th",{parentName:"tr",align:null},"Comment"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"submarine.auth.type"),(0,i.kt)("td",{parentName:"tr",align:null},"Supported authentication types, currently available are: none, simple, oauth2/oidc, ldap, kerberos, saml, cas"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null},"none"),(0,i.kt)("td",{parentName:"tr",align:null},"Only one authentication method can be supported at any one time")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"submarine.auth.token.maxAge"),(0,i.kt)("td",{parentName:"tr",align:null},"Expiry time of the token (minite)"),(0,i.kt)("td",{parentName:"tr",align:null},"int"),(0,i.kt)("td",{parentName:"tr",align:null},"1 day"),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"submarine.auth.refreshToken.maxAge"),(0,i.kt)("td",{parentName:"tr",align:null},"Expiry time of the refresh token (minite)"),(0,i.kt)("td",{parentName:"tr",align:null},"int"),(0,i.kt)("td",{parentName:"tr",align:null},"1 hour"),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"submarine.auth.oauth2.client.id"),(0,i.kt)("td",{parentName:"tr",align:null},"OAuth2 client id"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"submarine.auth.oauth2.client.secret"),(0,i.kt)("td",{parentName:"tr",align:null},"OAuth2 client secret"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"submarine.auth.oauth2.client.flows"),(0,i.kt)("td",{parentName:"tr",align:null},"OAuth2 flows, can be: authorizationCode, implicit, password or clientCredentials"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"submarine.auth.oauth2.scopes"),(0,i.kt)("td",{parentName:"tr",align:null},"The available scopes for the OAuth2 security scheme. A map between the scope name and a short description for it."),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"submarine.auth.oauth2.token.uri"),(0,i.kt)("td",{parentName:"tr",align:null},"OAuth2 access token uri"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"submarine.auth.oauth2.refresh.uri"),(0,i.kt)("td",{parentName:"tr",align:null},"OAuth2 refresh token uri"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"submarine.auth.oauth2.authorization.uri"),(0,i.kt)("td",{parentName:"tr",align:null},"OAuth2 authorization uri"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"submarine.auth.oauth2.logout.uri"),(0,i.kt)("td",{parentName:"tr",align:null},"OAuth2 logout uri"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"submarine.auth.oidc.client.id"),(0,i.kt)("td",{parentName:"tr",align:null},"OIDC client id"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"submarine.auth.oidc.client.secret"),(0,i.kt)("td",{parentName:"tr",align:null},"OIDC client Secret"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"submarine.auth.oidc.client.scopes"),(0,i.kt)("td",{parentName:"tr",align:null},"The available scopes for the OIDC security scheme. A map between the scope name and a short description for it."),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"submarine.auth.oidc.useNonce"),(0,i.kt)("td",{parentName:"tr",align:null},"Whether to use nonce during login process"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"submarine.auth.oidc.discover.uri"),(0,i.kt)("td",{parentName:"tr",align:null},"OIDC discovery uri"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"submarine.auth.oidc.logout.uri"),(0,i.kt)("td",{parentName:"tr",align:null},"OIDC logout uri"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"submarine.auth.ladp.provider.uri"),(0,i.kt)("td",{parentName:"tr",align:null},"LDAP provider uri"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null})),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"submarine.auth.ladp.baseDn"),(0,i.kt)("td",{parentName:"tr",align:null},"LDAP base DN"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},"base DN is the base LDAP distinguished name for your LDAP server. For example, ou=dev,dc=xyz,dc=com")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"submarine.auth.ladp.domain"),(0,i.kt)("td",{parentName:"tr",align:null},"LDAP AD domain"),(0,i.kt)("td",{parentName:"tr",align:null},"string"),(0,i.kt)("td",{parentName:"tr",align:null}),(0,i.kt)("td",{parentName:"tr",align:null},"AD domain is the domain name of the AD server. For example, corp.domain.com")))),(0,i.kt)("h3",{id:"design-and-implementation"},"Design and implementation"),(0,i.kt)("p",null,"We use ",(0,i.kt)("inlineCode",{parentName:"p"},"javax.servlet.Filter")," in the server to determine if authentication information exists for a user.\nThe ",(0,i.kt)("inlineCode",{parentName:"p"},"Filter")," is implemented for each authentication type and is configured according to the implementation of the type specified by ",(0,i.kt)("inlineCode",{parentName:"p"},"pac4j"),".\nAlso, a ",(0,i.kt)("inlineCode",{parentName:"p"},"SecurityFactory")," class is provided that instantiates the specified ",(0,i.kt)("inlineCode",{parentName:"p"},"Filter")," class into Jetty's filter based on ",(0,i.kt)("inlineCode",{parentName:"p"},"submarine.auth.type"),"."),(0,i.kt)("p",null,"Except in the case of ",(0,i.kt)("inlineCode",{parentName:"p"},"submarine.auth.type")," being ",(0,i.kt)("inlineCode",{parentName:"p"},"none"),", and some APIs necessary for authentication (login requests, etc.), we will require the token to be included in the header.\nThe token is generated and verified based on ",(0,i.kt)("inlineCode",{parentName:"p"},"pac4j")," and processed inside the ",(0,i.kt)("inlineCode",{parentName:"p"},"Filter")," class, incorrect token or no token will return a 401 HTTP code."),(0,i.kt)("p",null,"When a token expires, it can be regenerated by calling the refresh token method. The default token expiry time is now set to 1 day (by modifying ",(0,i.kt)("inlineCode",{parentName:"p"},"submarine.auth.token.maxAge"),") and the refresh token expiry time is 1 hour."),(0,i.kt)("h3",{id:"users"},"Users"),(0,i.kt)("p",null,"Describe the design of relevant user tables, user registration/modification/deletion processes,\nand the processing logic associated with authenticated login\n(including the mapping of attributes for automatically registered users when integrating with other authentication platforms, etc.)."),(0,i.kt)("p",null,"We use ",(0,i.kt)("inlineCode",{parentName:"p"},"sys_user")," table to store user information for submarines.",(0,i.kt)("br",{parentName:"p"}),"\n","When ",(0,i.kt)("inlineCode",{parentName:"p"},"submarine.auth.type")," is ",(0,i.kt)("inlineCode",{parentName:"p"},"simple"),", the user's login operation will match ",(0,i.kt)("inlineCode",{parentName:"p"},"user_name")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"password")," (encrypted) in ",(0,i.kt)("inlineCode",{parentName:"p"},"sys_user"),". Only when the user name and password match will the login succeed.",(0,i.kt)("br",{parentName:"p"}),"\n","When ",(0,i.kt)("inlineCode",{parentName:"p"},"submarine.auth.type")," is ",(0,i.kt)("inlineCode",{parentName:"p"},"ldap"),", the user's login will operation request the LDAP and verify that the username and password are correct. A new record will be added to the ",(0,i.kt)("inlineCode",{parentName:"p"},"sys_user")," table if the logged-in user does not exist.",(0,i.kt)("br",{parentName:"p"}),"\n","When logging in using other third-party authentication (OAuth2/OpenID Connect (OIDC), SAML, CAS etc.), the login page will automatically jump to the third-party service and revert back to the submarine after a successful login. A new record will be added to the ",(0,i.kt)("inlineCode",{parentName:"p"},"sys_user")," table if the logged-in user does not exist.  "),(0,i.kt)("h4",{id:"department"},"Department"),(0,i.kt)("p",null,"[TODO]"),(0,i.kt)("h4",{id:"role"},"Role"),(0,i.kt)("p",null,"[TODO]"),(0,i.kt)("h3",{id:"rbac"},"RBAC"),(0,i.kt)("p",null,"[TODO]"))}c.isMDXComponent=!0}}]);